provider "aws" {
    region     = "{{ aws_region }}"
}
  
terraform {
    backend "s3" {
        bucket  = "{{ project_id }}-tfstate"
        encrypt = true
        key     = "{{ project_name }}-{{ environment }}.tfstate"
        region  = "{{ aws_region }}"
        dynamodb_table = "{{ project_id }}-tfstate-lock"
    }
}

module "vpc" {
    source = "./modules/vpc"
    name = "{{ project_name }}-{{ environment }}-vpc"
    environment = "{{ environment }}"
    cidr = "{{ aws_vpc_cidr }}"
}

module "eks" {
    source                  = "./modules/eks-fargate"
    name                    = "{{ project_name }}"
    environment             = "{{ environment }}"
    vpc_id                  = module.vpc.id
    vpc_private_subnets     = module.vpc.private_subnets
  }
